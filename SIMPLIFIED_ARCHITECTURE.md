# ğŸ¯ ê°„ì†Œí™”ëœ ì•„í‚¤í…ì²˜ - CI ì‹œìŠ¤í…œ ì—°ë™

## ğŸ—ï¸ ìµœì¢… ì•„í‚¤í…ì²˜ (ê°„ì†Œí™”)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Bamboo CI / ë‹¤ë¥¸ CI ì‹œìŠ¤í…œ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. ë¹Œë“œ ì‹¤íŒ¨ ê°ì§€                                    â”‚  â”‚
â”‚  â”‚  2. ë¡œê·¸ íŒŒì¼ ì½ê¸°                                    â”‚  â”‚
â”‚  â”‚  3. Agentì— REST API ìš”ì²­                            â”‚  â”‚
â”‚  â”‚     POST /analyze                                    â”‚  â”‚
â”‚  â”‚  4. ë¶„ì„ ê²°ê³¼ + ìŠ¹ì¸ í† í° ë°›ìŒ                        â”‚  â”‚
â”‚  â”‚  5. ì´ë©”ì¼ ì „ì†¡ (SMTP)                               â”‚  â”‚
â”‚  â”‚     - ê°œë°œì: ë¶„ì„ ê²°ê³¼                              â”‚  â”‚
â”‚  â”‚     - ê´€ë¦¬ì: ë¶„ì„ ê²°ê³¼ + ìŠ¹ì¸ ë§í¬                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ POST /analyze
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Kubernetes Pod: ci-error-agent                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI ì„œë²„ (3ê°œ ì£¼ìš” APIë§Œ)                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  POST /analyze                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ë¶„ì„ ì‹¤í–‰ (LangGraph)                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - DB ì €ì¥                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ìŠ¹ì¸ í† í° ìƒì„± (JWT, 7ì¼)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ë°˜í™˜: ë¶„ì„ ê²°ê³¼ + approval_url              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  GET /approve/{token}                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - í† í° ê²€ì¦                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - KBì— ì €ì¥                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - í™•ì¸ í˜ì´ì§€ í‘œì‹œ                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  GET /modify/{token}                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ìˆ˜ì • í˜ì´ì§€ í‘œì‹œ                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ìˆ˜ì • í›„ KBì— ì €ì¥                            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PostgreSQL Database                            â”‚
â”‚  - knowledge_base (ì§€ì‹ë² ì´ìŠ¤)                              â”‚
â”‚  - analysis_history (ë¶„ì„ ì´ë ¥)                             â”‚
â”‚  - pending_approvals (ìŠ¹ì¸ ëŒ€ê¸°)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ì´ë©”ì¼ ìˆ˜ì‹  (ê´€ë¦¬ì)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ì´ë©”ì¼ ë‚´ìš©:                                         â”‚  â”‚
â”‚  â”‚  - ì˜¤ë¥˜ ë¶„ì„ ê²°ê³¼                                     â”‚  â”‚
â”‚  â”‚  - [âœ… ìŠ¹ì¸] ë²„íŠ¼ â†’ http://agent/approve/{token}     â”‚  â”‚
â”‚  â”‚  - [âœï¸ ìˆ˜ì •] ë²„íŠ¼ â†’ http://agent/modify/{token}      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ì›Œí¬í”Œë¡œìš°

### ì „ì²´ í”„ë¡œì„¸ìŠ¤

```
1. CI ì‹œìŠ¤í…œ: ë¹Œë“œ ì‹¤íŒ¨
   â†“
2. CI ì‹œìŠ¤í…œ: ë¡œê·¸ íŒŒì¼ ì½ê¸°
   â†“
3. CI ì‹œìŠ¤í…œ â†’ Agent: POST /analyze
   {
     "ci_log": "...",
     "repository": "automotive-ecu",
     "job_name": "BUILD-COMPILE",
     "build_number": 123
   }
   â†“
4. Agent: LangGraph ë¶„ì„ ì‹¤í–‰
   - ì¦ìƒ ì¶”ì¶œ
   - KB ê²€ìƒ‰ (ì‹ ë¢°ë„ â‰¥0.8ì´ë©´ ì›¹ ê²€ìƒ‰ ìƒëµ)
   - ë³´ì•ˆ ê²€ì¦
   - ì›¹ ê²€ìƒ‰ (ì¡°ê±´ë¶€)
   - LLM ë¶„ì„
   â†“
5. Agent â†’ CI ì‹œìŠ¤í…œ: ì‘ë‹µ ë°˜í™˜
   {
     "analysis_id": 456,
     "error_type": "tasking",
     "confidence": 0.85,
     "analysis": "ë¶„ì„ ê²°ê³¼...",
     "approval_token": "eyJ...",
     "approval_url": "http://agent/approve/eyJ...",
     "modify_url": "http://agent/modify/eyJ...",
     "recommend_save": true
   }
   â†“
6. CI ì‹œìŠ¤í…œ: ì´ë©”ì¼ ì „ì†¡ (SMTP)
   - To: developer@company.com, admin@company.com
   - ë‚´ìš©: ë¶„ì„ ê²°ê³¼ + ìŠ¹ì¸ ë§í¬
   â†“
7. ê´€ë¦¬ì: ì´ë©”ì¼ í™•ì¸
   â†“
8. ê´€ë¦¬ì: ìŠ¹ì¸ ë§í¬ í´ë¦­
   â†’ GET /approve/{token}
   â†“
9. Agent: KBì— ì €ì¥
   â†“
10. ì›¹ í˜ì´ì§€: "âœ… KBì— ì €ì¥ ì™„ë£Œ!" í‘œì‹œ
   â†“
11. ë‹¤ìŒ ë²ˆ ë™ì¼ ì˜¤ë¥˜: KBì—ì„œ ì¦‰ì‹œ ì°¾ì•„ì„œ ë¹ ë¥¸ ë‹µë³€!
```

## ğŸ¯ ì£¼ìš” ë³€ê²½ ì‚¬í•­

### âŒ **ì œê±°ëœ ê²ƒ**
- ~~bamboo-watcher~~ (íŒŒì¼ ê°ì‹œ ë¶ˆí•„ìš”)
- ~~k8s/bamboo-watcher-deployment.yaml~~
- ~~Agentì—ì„œ ì´ë©”ì¼ ì „ì†¡~~ (CI ì‹œìŠ¤í…œì—ì„œ ë‹´ë‹¹)

### âœ… **ì¶”ê°€ëœ ê²ƒ**
- **ê°„ì†Œí™”ëœ API**: `app/main_simple.py`
- **CI ì‹œìŠ¤í…œ ì˜ˆì‹œ ì½”ë“œ**: `ci_system_example.py`
- **ìŠ¹ì¸ í† í° í¬í•¨ ì‘ë‹µ**: `approval_url`, `modify_url`

## ğŸ“ CI ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë²•

### Python ì˜ˆì‹œ (Bamboo Script)

```python
import requests
import os

# 1. ë¡œê·¸ íŒŒì¼ ì½ê¸°
log_file = "${bamboo.build.working.directory}/build.log"
with open(log_file, 'r') as f:
    ci_log = f.read()

# 2. Agent API í˜¸ì¶œ
response = requests.post(
    "http://ci-error-agent-service:8000/analyze",
    json={
        "ci_log": ci_log,
        "repository": "${bamboo.planRepository.repositoryUrl}",
        "job_name": "${bamboo.shortJobName}",
        "build_number": int("${bamboo.buildNumber}")
    }
)

result = response.json()

# 3. ì´ë©”ì¼ ì „ì†¡ (Bambooì˜ ì´ë©”ì¼ ê¸°ëŠ¥ ë˜ëŠ” Python SMTP)
import smtplib
from email.mime.text import MIMEText

msg = MIMEText(f"""
ì˜¤ë¥˜ íƒ€ì…: {result['error_type']}
ì‹ ë¢°ë„: {result['confidence']}
ë¶„ì„ ê²°ê³¼: {result['analysis']}

KB ì €ì¥ ìŠ¹ì¸: {result['approval_url']}
ìˆ˜ì • í›„ ìŠ¹ì¸: {result['modify_url']}
""")

msg['Subject'] = f"CI ì˜¤ë¥˜: {result['error_type']}"
msg['From'] = "ci@company.com"
msg['To'] = "developer@company.com, admin@company.com"

# SMTP ì „ì†¡
# ...
```

### Shell Script ì˜ˆì‹œ (Bamboo Shell Task)

```bash
#!/bin/bash

# ë¡œê·¸ íŒŒì¼
LOG_FILE="${bamboo.build.working.directory}/build.log"

# Agent API í˜¸ì¶œ
RESULT=$(curl -s -X POST http://ci-error-agent-service:8000/analyze \
  -H "Content-Type: application/json" \
  -d "{
    \"ci_log\": \"$(cat $LOG_FILE | jq -Rs .)\",
    \"repository\": \"${bamboo.planRepository.repositoryUrl}\",
    \"job_name\": \"${bamboo.shortJobName}\",
    \"build_number\": ${bamboo.buildNumber}
  }")

# ìŠ¹ì¸ ë§í¬ ì¶”ì¶œ
APPROVAL_URL=$(echo $RESULT | jq -r '.approval_url')

# ì´ë©”ì¼ ì „ì†¡ (Bamboo ì´ë©”ì¼ ê¸°ëŠ¥ ì‚¬ìš©)
echo "ë¶„ì„ ê²°ê³¼: $RESULT" | mail -s "CI ì˜¤ë¥˜" admin@company.com
```

## ğŸ“§ ì´ë©”ì¼ í…œí”Œë¦¿ (CI ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©)

```html
<!DOCTYPE html>
<html>
<body>
  <h1>ğŸš— CI ì˜¤ë¥˜ ë¶„ì„ ê²°ê³¼</h1>
  
  <p><strong>ì˜¤ë¥˜ íƒ€ì…:</strong> {error_type}</p>
  <p><strong>ì‹ ë¢°ë„:</strong> {confidence}%</p>
  
  <h3>ë¶„ì„ ê²°ê³¼:</h3>
  <pre>{analysis}</pre>
  
  <!-- ìŠ¹ì¸ ë§í¬ (ì‹ ë¢°ë„ ë†’ì„ ë•Œë§Œ) -->
  <div style="margin: 30px 0; text-align: center;">
    <h3>ì´ ë¶„ì„ ê²°ê³¼ë¥¼ KBì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
    <a href="{approval_url}" style="padding: 12px 24px; background: #4caf50; color: white; text-decoration: none; border-radius: 5px;">
      âœ… ìŠ¹ì¸ (KBì— ì €ì¥)
    </a>
    <a href="{modify_url}" style="padding: 12px 24px; background: #ff9800; color: white; text-decoration: none; border-radius: 5px;">
      âœï¸ ìˆ˜ì • í›„ ìŠ¹ì¸
    </a>
  </div>
  
  <p>ë§í¬ëŠ” 7ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤.</p>
</body>
</html>
```

## ğŸš€ ë°°í¬ (ê°„ì†Œí™”)

```bash
# 1. Secrets
kubectl apply -f k8s/secrets.yaml

# 2. PostgreSQL
kubectl apply -f k8s/postgres.yaml

# 3. Docker ë¹Œë“œ
docker build -t ci-error-agent:latest .

# 4. Agentë§Œ ë°°í¬ (Watcher ë¶ˆí•„ìš”!)
kubectl apply -f k8s/deployment.yaml

# 5. í™•ì¸
kubectl get pods
kubectl get svc
```

## ğŸ’¡ ì´ êµ¬ì¡°ì˜ ì¥ì 

### âœ… **ë‹¨ìˆœì„±**
- CI ì‹œìŠ¤í…œì´ ëª¨ë“  ê²ƒì„ ì œì–´
- AgentëŠ” ìˆœìˆ˜ ë¶„ì„ë§Œ ë‹´ë‹¹
- íŒŒì¼ ê°ì‹œ ë¶ˆí•„ìš”

### âœ… **ìœ ì—°ì„±**
- Bambooë¿ ì•„ë‹ˆë¼ Jenkins, GitLab CI ë“± ì–´ë–¤ CIë“  ì‚¬ìš© ê°€ëŠ¥
- CI ì‹œìŠ¤í…œì˜ ê¸°ì¡´ ì´ë©”ì¼ ê¸°ëŠ¥ í™œìš© ê°€ëŠ¥
- REST APIë§Œ í˜¸ì¶œí•˜ë©´ ë¨

### âœ… **ë³´ì•ˆ**
- CI ì‹œìŠ¤í…œ ë‚´ë¶€ì—ì„œ ë¡œê·¸ ì²˜ë¦¬
- AgentëŠ” ìŠ¹ì¸ ë§í¬ ì²˜ë¦¬ë§Œ
- JWT í† í° 7ì¼ ë§Œë£Œ

### âœ… **í™•ì¥ì„±**
- CI ì‹œìŠ¤í…œë³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥
- ì´ë©”ì¼ í…œí”Œë¦¿ ììœ ë¡­ê²Œ ìˆ˜ì •
- ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš° ìœ ì—°

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸

1. **CI ì‹œìŠ¤í…œ**: ë¡œê·¸ ì½ê¸° + API í˜¸ì¶œ + ì´ë©”ì¼ ì „ì†¡
2. **Agent**: ë¶„ì„ + í† í° ìƒì„± + ìŠ¹ì¸ ì²˜ë¦¬
3. **ì´ë©”ì¼**: ìŠ¹ì¸ ë§í¬ í¬í•¨ (JWT í† í°)
4. **ê´€ë¦¬ì**: ì´ë©”ì¼ ë§í¬ í´ë¦­ â†’ KB ì €ì¥

**ê°€ì¥ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì¸ êµ¬ì¡°ì…ë‹ˆë‹¤!** ğŸš—âœ¨

